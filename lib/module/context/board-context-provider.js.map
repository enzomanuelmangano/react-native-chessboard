{"version":3,"names":["Chess","React","useImperativeHandle","useMemo","useRef","useState","useConst","BoardContext","BoardSetterContext","BoardOperationsContextProvider","BoardPromotionContextProvider","BoardRefsContextProvider","ChessEngineContext","ChessboardContextProviderComponent","forwardRef","ref","children","fen","chess","chessboardRef","boardOperationsRef","board","setBoard","chessboardController","move","params","current","highlight","resetAllHighlightedSquares","getState","resetBoard","reset","ChessboardContextProvider","memo"],"sources":["board-context-provider.tsx"],"sourcesContent":["import { Chess } from 'chess.js';\r\nimport React, { useImperativeHandle, useMemo, useRef, useState } from 'react';\r\nimport type { ChessboardState } from '../helpers/get-chessboard-state';\r\nimport { useConst } from '../hooks/use-const';\r\n\r\nimport { BoardContext, BoardSetterContext } from './board-context';\r\nimport {\r\n  BoardOperationsContextProvider,\r\n  BoardOperationsRef,\r\n} from './board-operations-context';\r\nimport { BoardPromotionContextProvider } from './board-promotion-context';\r\nimport { BoardRefsContextProvider, ChessboardRef } from './board-refs-context';\r\nimport { ChessEngineContext } from './chess-engine-context';\r\n\r\ntype BoardContextProviderProps = {\r\n  fen?: string;\r\n  children?: React.ReactNode;\r\n};\r\n\r\nconst ChessboardContextProviderComponent = React.forwardRef<\r\n  ChessboardRef,\r\n  BoardContextProviderProps\r\n>(({ children, fen }, ref) => {\r\n  const chess = useConst(() => new Chess(fen));\r\n  const chessboardRef = useRef<ChessboardRef>(null);\r\n  const boardOperationsRef = useRef<BoardOperationsRef>(null);\r\n\r\n  const [board, setBoard] = useState(chess.board());\r\n\r\n  const chessboardController: ChessboardRef = useMemo(() => {\r\n    return {\r\n      move: (params) => chessboardRef.current?.move?.(params),\r\n      highlight: (params) => chessboardRef.current?.highlight(params),\r\n      resetAllHighlightedSquares: () =>\r\n        chessboardRef.current?.resetAllHighlightedSquares(),\r\n      getState: () => chessboardRef?.current?.getState() as ChessboardState,\r\n      resetBoard: (params) => {\r\n        chessboardRef.current?.resetBoard(params);\r\n        boardOperationsRef.current?.reset();\r\n      },\r\n    };\r\n  }, []);\r\n\r\n  useImperativeHandle(ref, () => chessboardController, [chessboardController]);\r\n\r\n  return (\r\n    <BoardContext.Provider value={board}>\r\n      <BoardPromotionContextProvider>\r\n        <ChessEngineContext.Provider value={chess}>\r\n          <BoardSetterContext.Provider value={setBoard}>\r\n            <BoardRefsContextProvider ref={chessboardRef}>\r\n              <BoardOperationsContextProvider\r\n                ref={boardOperationsRef}\r\n                controller={chessboardController}\r\n              >\r\n                {children}\r\n              </BoardOperationsContextProvider>\r\n            </BoardRefsContextProvider>\r\n          </BoardSetterContext.Provider>\r\n        </ChessEngineContext.Provider>\r\n      </BoardPromotionContextProvider>\r\n    </BoardContext.Provider>\r\n  );\r\n});\r\n\r\nconst ChessboardContextProvider = React.memo(\r\n  ChessboardContextProviderComponent\r\n);\r\nexport {\r\n  ChessboardContextProvider,\r\n  ChessEngineContext,\r\n  BoardContext,\r\n  BoardSetterContext,\r\n};\r\n"],"mappings":"AAAA,SAASA,KAAT,QAAsB,UAAtB;AACA,OAAOC,KAAP,IAAgBC,mBAAhB,EAAqCC,OAArC,EAA8CC,MAA9C,EAAsDC,QAAtD,QAAsE,OAAtE;AAEA,SAASC,QAAT,QAAyB,oBAAzB;AAEA,SAASC,YAAT,EAAuBC,kBAAvB,QAAiD,iBAAjD;AACA,SACEC,8BADF,QAGO,4BAHP;AAIA,SAASC,6BAAT,QAA8C,2BAA9C;AACA,SAASC,wBAAT,QAAwD,sBAAxD;AACA,SAASC,kBAAT,QAAmC,wBAAnC;AAOA,MAAMC,kCAAkC,gBAAGZ,KAAK,CAACa,UAAN,CAGzC,OAAoBC,GAApB,KAA4B;EAAA,IAA3B;IAAEC,QAAF;IAAYC;EAAZ,CAA2B;EAC5B,MAAMC,KAAK,GAAGZ,QAAQ,CAAC,MAAM,IAAIN,KAAJ,CAAUiB,GAAV,CAAP,CAAtB;EACA,MAAME,aAAa,GAAGf,MAAM,CAAgB,IAAhB,CAA5B;EACA,MAAMgB,kBAAkB,GAAGhB,MAAM,CAAqB,IAArB,CAAjC;EAEA,MAAM,CAACiB,KAAD,EAAQC,QAAR,IAAoBjB,QAAQ,CAACa,KAAK,CAACG,KAAN,EAAD,CAAlC;EAEA,MAAME,oBAAmC,GAAGpB,OAAO,CAAC,MAAM;IACxD,OAAO;MACLqB,IAAI,EAAGC,MAAD;QAAA;;QAAA,gCAAYN,aAAa,CAACO,OAA1B,oFAAY,sBAAuBF,IAAnC,2DAAY,mDAA8BC,MAA9B,CAAZ;MAAA,CADD;MAELE,SAAS,EAAGF,MAAD;QAAA;;QAAA,iCAAYN,aAAa,CAACO,OAA1B,2DAAY,uBAAuBC,SAAvB,CAAiCF,MAAjC,CAAZ;MAAA,CAFN;MAGLG,0BAA0B,EAAE;QAAA;;QAAA,iCAC1BT,aAAa,CAACO,OADY,2DAC1B,uBAAuBE,0BAAvB,EAD0B;MAAA,CAHvB;MAKLC,QAAQ,EAAE;QAAA;;QAAA,OAAMV,aAAN,aAAMA,aAAN,iDAAMA,aAAa,CAAEO,OAArB,2DAAM,uBAAwBG,QAAxB,EAAN;MAAA,CALL;MAMLC,UAAU,EAAGL,MAAD,IAAY;QAAA;;QACtB,0BAAAN,aAAa,CAACO,OAAd,kFAAuBI,UAAvB,CAAkCL,MAAlC;QACA,yBAAAL,kBAAkB,CAACM,OAAnB,gFAA4BK,KAA5B;MACD;IATI,CAAP;EAWD,CAZkD,EAYhD,EAZgD,CAAnD;EAcA7B,mBAAmB,CAACa,GAAD,EAAM,MAAMQ,oBAAZ,EAAkC,CAACA,oBAAD,CAAlC,CAAnB;EAEA,oBACE,oBAAC,YAAD,CAAc,QAAd;IAAuB,KAAK,EAAEF;EAA9B,gBACE,oBAAC,6BAAD,qBACE,oBAAC,kBAAD,CAAoB,QAApB;IAA6B,KAAK,EAAEH;EAApC,gBACE,oBAAC,kBAAD,CAAoB,QAApB;IAA6B,KAAK,EAAEI;EAApC,gBACE,oBAAC,wBAAD;IAA0B,GAAG,EAAEH;EAA/B,gBACE,oBAAC,8BAAD;IACE,GAAG,EAAEC,kBADP;IAEE,UAAU,EAAEG;EAFd,GAIGP,QAJH,CADF,CADF,CADF,CADF,CADF,CADF;AAkBD,CA5C0C,CAA3C;AA8CA,MAAMgB,yBAAyB,gBAAG/B,KAAK,CAACgC,IAAN,CAChCpB,kCADgC,CAAlC;AAGA,SACEmB,yBADF,EAEEpB,kBAFF,EAGEL,YAHF,EAIEC,kBAJF"}