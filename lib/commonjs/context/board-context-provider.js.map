{"version":3,"names":["ChessboardContextProviderComponent","React","forwardRef","ref","children","fen","chess","useConst","Chess","chessboardRef","useRef","boardOperationsRef","board","setBoard","useState","chessboardController","useMemo","move","params","current","highlight","resetAllHighlightedSquares","getState","resetBoard","reset","useImperativeHandle","ChessboardContextProvider","memo"],"sources":["board-context-provider.tsx"],"sourcesContent":["import { Chess } from 'chess.js';\r\nimport React, { useImperativeHandle, useMemo, useRef, useState } from 'react';\r\nimport type { ChessboardState } from '../helpers/get-chessboard-state';\r\nimport { useConst } from '../hooks/use-const';\r\n\r\nimport { BoardContext, BoardSetterContext } from './board-context';\r\nimport {\r\n  BoardOperationsContextProvider,\r\n  BoardOperationsRef,\r\n} from './board-operations-context';\r\nimport { BoardPromotionContextProvider } from './board-promotion-context';\r\nimport { BoardRefsContextProvider, ChessboardRef } from './board-refs-context';\r\nimport { ChessEngineContext } from './chess-engine-context';\r\n\r\ntype BoardContextProviderProps = {\r\n  fen?: string;\r\n  children?: React.ReactNode;\r\n};\r\n\r\nconst ChessboardContextProviderComponent = React.forwardRef<\r\n  ChessboardRef,\r\n  BoardContextProviderProps\r\n>(({ children, fen }, ref) => {\r\n  const chess = useConst(() => new Chess(fen));\r\n  const chessboardRef = useRef<ChessboardRef>(null);\r\n  const boardOperationsRef = useRef<BoardOperationsRef>(null);\r\n\r\n  const [board, setBoard] = useState(chess.board());\r\n\r\n  const chessboardController: ChessboardRef = useMemo(() => {\r\n    return {\r\n      move: (params) => chessboardRef.current?.move?.(params),\r\n      highlight: (params) => chessboardRef.current?.highlight(params),\r\n      resetAllHighlightedSquares: () =>\r\n        chessboardRef.current?.resetAllHighlightedSquares(),\r\n      getState: () => chessboardRef?.current?.getState() as ChessboardState,\r\n      resetBoard: (params) => {\r\n        chessboardRef.current?.resetBoard(params);\r\n        boardOperationsRef.current?.reset();\r\n      },\r\n    };\r\n  }, []);\r\n\r\n  useImperativeHandle(ref, () => chessboardController, [chessboardController]);\r\n\r\n  return (\r\n    <BoardContext.Provider value={board}>\r\n      <BoardPromotionContextProvider>\r\n        <ChessEngineContext.Provider value={chess}>\r\n          <BoardSetterContext.Provider value={setBoard}>\r\n            <BoardRefsContextProvider ref={chessboardRef}>\r\n              <BoardOperationsContextProvider\r\n                ref={boardOperationsRef}\r\n                controller={chessboardController}\r\n              >\r\n                {children}\r\n              </BoardOperationsContextProvider>\r\n            </BoardRefsContextProvider>\r\n          </BoardSetterContext.Provider>\r\n        </ChessEngineContext.Provider>\r\n      </BoardPromotionContextProvider>\r\n    </BoardContext.Provider>\r\n  );\r\n});\r\n\r\nconst ChessboardContextProvider = React.memo(\r\n  ChessboardContextProviderComponent\r\n);\r\nexport {\r\n  ChessboardContextProvider,\r\n  ChessEngineContext,\r\n  BoardContext,\r\n  BoardSetterContext,\r\n};\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AAEA;;AAEA;;AACA;;AAIA;;AACA;;AACA;;;;;;AAOA,MAAMA,kCAAkC,gBAAGC,cAAA,CAAMC,UAAN,CAGzC,OAAoBC,GAApB,KAA4B;EAAA,IAA3B;IAAEC,QAAF;IAAYC;EAAZ,CAA2B;EAC5B,MAAMC,KAAK,GAAG,IAAAC,kBAAA,EAAS,MAAM,IAAIC,YAAJ,CAAUH,GAAV,CAAf,CAAd;EACA,MAAMI,aAAa,GAAG,IAAAC,aAAA,EAAsB,IAAtB,CAAtB;EACA,MAAMC,kBAAkB,GAAG,IAAAD,aAAA,EAA2B,IAA3B,CAA3B;EAEA,MAAM,CAACE,KAAD,EAAQC,QAAR,IAAoB,IAAAC,eAAA,EAASR,KAAK,CAACM,KAAN,EAAT,CAA1B;EAEA,MAAMG,oBAAmC,GAAG,IAAAC,cAAA,EAAQ,MAAM;IACxD,OAAO;MACLC,IAAI,EAAGC,MAAD;QAAA;;QAAA,gCAAYT,aAAa,CAACU,OAA1B,oFAAY,sBAAuBF,IAAnC,2DAAY,mDAA8BC,MAA9B,CAAZ;MAAA,CADD;MAELE,SAAS,EAAGF,MAAD;QAAA;;QAAA,iCAAYT,aAAa,CAACU,OAA1B,2DAAY,uBAAuBC,SAAvB,CAAiCF,MAAjC,CAAZ;MAAA,CAFN;MAGLG,0BAA0B,EAAE;QAAA;;QAAA,iCAC1BZ,aAAa,CAACU,OADY,2DAC1B,uBAAuBE,0BAAvB,EAD0B;MAAA,CAHvB;MAKLC,QAAQ,EAAE;QAAA;;QAAA,OAAMb,aAAN,aAAMA,aAAN,iDAAMA,aAAa,CAAEU,OAArB,2DAAM,uBAAwBG,QAAxB,EAAN;MAAA,CALL;MAMLC,UAAU,EAAGL,MAAD,IAAY;QAAA;;QACtB,0BAAAT,aAAa,CAACU,OAAd,kFAAuBI,UAAvB,CAAkCL,MAAlC;QACA,yBAAAP,kBAAkB,CAACQ,OAAnB,gFAA4BK,KAA5B;MACD;IATI,CAAP;EAWD,CAZ2C,EAYzC,EAZyC,CAA5C;EAcA,IAAAC,0BAAA,EAAoBtB,GAApB,EAAyB,MAAMY,oBAA/B,EAAqD,CAACA,oBAAD,CAArD;EAEA,oBACE,6BAAC,0BAAD,CAAc,QAAd;IAAuB,KAAK,EAAEH;EAA9B,gBACE,6BAAC,oDAAD,qBACE,6BAAC,sCAAD,CAAoB,QAApB;IAA6B,KAAK,EAAEN;EAApC,gBACE,6BAAC,gCAAD,CAAoB,QAApB;IAA6B,KAAK,EAAEO;EAApC,gBACE,6BAAC,0CAAD;IAA0B,GAAG,EAAEJ;EAA/B,gBACE,6BAAC,sDAAD;IACE,GAAG,EAAEE,kBADP;IAEE,UAAU,EAAEI;EAFd,GAIGX,QAJH,CADF,CADF,CADF,CADF,CADF,CADF;AAkBD,CA5C0C,CAA3C;;AA8CA,MAAMsB,yBAAyB,gBAAGzB,cAAA,CAAM0B,IAAN,CAChC3B,kCADgC,CAAlC"}